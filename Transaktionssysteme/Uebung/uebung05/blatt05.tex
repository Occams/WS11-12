%%%
% Excercise Template
%%%

%\listfiles 
\documentclass[12pt]{scrartcl} 
\usepackage[ngerman]{babel}
    
\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}

\usepackage{amsmath}
\usepackage{graphicx,enumitem,wasysym,multicol,libertine,xcolor,microtype,lipsum,fixltx2e,
	fancyhdr,vmargin,calc,lastpage,hyperref,listings,lastpage,lipsum,preview,tikz,rotating,multirow,tabularx}
\usetikzlibrary{snakes,arrows,shapes}


% ------------------------------------------
% -------- xcolor - (Tango)
% ------------------------------------------

\definecolor{LightButter}{rgb}{0.98,0.91,0.31}
\definecolor{LightOrange}{rgb}{0.98,0.68,0.24}
\definecolor{LightChocolate}{rgb}{0.91,0.72,0.43}
\definecolor{LightChameleon}{rgb}{0.54,0.88,0.20}
\definecolor{LightSkyBlue}{rgb}{0.45,0.62,0.81}
\definecolor{LightPlum}{rgb}{0.68,0.50,0.66}
\definecolor{LightScarletRed}{rgb}{0.93,0.16,0.16}
\definecolor{Butter}{rgb}{0.93,0.86,0.25}
\definecolor{Orange}{rgb}{0.96,0.47,0.00}
\definecolor{Chocolate}{rgb}{0.75,0.49,0.07}
\definecolor{Chameleon}{rgb}{0.45,0.82,0.09}
\definecolor{SkyBlue}{rgb}{0.20,0.39,0.64}
\definecolor{Plum}{rgb}{0.46,0.31,0.48}
\definecolor{ScarletRed}{rgb}{0.80,0.00,0.00}
\definecolor{DarkButter}{rgb}{0.77,0.62,0.00}
\definecolor{DarkOrange}{rgb}{0.80,0.36,0.00}
\definecolor{DarkChocolate}{rgb}{0.56,0.35,0.01}
\definecolor{DarkChameleon}{rgb}{0.30,0.60,0.02}
\definecolor{DarkSkyBlue}{rgb}{0.12,0.29,0.53}
\definecolor{DarkPlum}{rgb}{0.36,0.21,0.40}
\definecolor{DarkScarletRed}{rgb}{0.64,0.00,0.00}
\definecolor{Aluminium1}{rgb}{0.93,0.93,0.92}
\definecolor{Aluminium2}{rgb}{0.82,0.84,0.81}
\definecolor{Aluminium3}{rgb}{0.73,0.74,0.71}
\definecolor{Aluminium4}{rgb}{0.53,0.54,0.52}
\definecolor{Aluminium5}{rgb}{0.33,0.34,0.32}
\definecolor{Aluminium6}{rgb}{0.18,0.20,0.21}
\definecolor{Brown}{cmyk}{0,0.81,1,0.60}
\definecolor{OliveGreen}{cmyk}{0.64,0,0.95,0.40}
\definecolor{CadetBlue}{cmyk}{0.62,0.57,0.23,0}

% ------------------------------------------
% -------- vmargin
% ------------------------------------------

%\setmarginsrb{hleftmargini}{htopmargini}{hrightmargini}{hbottommargini}%{hheadheighti}{hheadsepi}{hfootheighti}{hfootskipi}
\setpapersize{A4}
\setmarginsrb{3cm}{1cm}{3cm}{1cm}{8mm}{4mm}{3mm}{15mm}

% ------------------------------------------
% -------- listings
% ------------------------------------------
 
\lstdefinestyle{inline} {
		basicstyle=\normalsize
		}

\lstset{
		breakautoindent=true,
		breakindent=2em,
		breaklines=true,
		tabsize=4,
		frame=blrt,
		frameround=tttt,
		captionpos=b,
		basicstyle=\scriptsize\ttfamily,
		keywordstyle={\color{SkyBlue}},
		%commentstyle={\color{OliveGreen}},
		stringstyle={\color{OliveGreen}},
		showspaces=false,
		%numbers=right,
		%numberstyle=\scriptsize,
		%stepnumber=1, 
		%numbersep=5pt,
		%showtabs=false
		prebreak = \raisebox{0ex}[0ex][0ex]{\ensuremath{\hookleftarrow}},
		aboveskip={1.5\baselineskip},
		columns=fixed,
		upquote=true,
		extendedchars=true
		}


% ------------------------------------------
% -------- hyperref
% ------------------------------------------

\hypersetup{
	%breaklinks=true,
	pdfborder={0 0 0},
	bookmarks=true,         % show bookmarks bar?
	unicode=false,          % non-Latin characters in Acrobat’s bookmarks
	pdftoolbar=true,        % show Acrobat’s toolbar?
	pdfmenubar=true,        % show Acrobat’s menu?
	pdffitwindow=true,     % window fit to page when opened
	pdfstartview={FitH},    % fits the width of the page to the window
    pdfnewwindow=true,      % links in new window
    colorlinks=true,       % false: boxed links; true: colored links
    linkcolor=black,          % color of internal links
    citecolor=black,        % color of links to bibliography
    filecolor=magenta,      % color of file links
    urlcolor=DarkSkyBlue           % color of external links
}

% ------------------------------------------
% -------- fancyhdr
% ------------------------------------------
\fancyheadoffset{\marginparsep+\marginparwidth}
\fancyhf{}
\fancyhead[L]{\bfseries{\nouppercase{\leftmark}}}
\fancyfoot[C]{\bfseries{\thepage\ of \pageref{LastPage}}}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0pt}

% ------------------------------------------
% -------- pdf specific
% ------------------------------------------

\pdfcompresslevel=3
%\pdfimageresolution=300
%\pdfinfo{
%/CreationDate (D:2010 09 01 00 00 00) % year(4) month(2) day(2) hour(2) minute(2) second(2)
%/ModDate      (D:2010 09 01 00 00 00) % modification date
%}

% ------------------------------------------
% -------- misc
% ------------------------------------------
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}
\clubpenalty = 10000
\widowpenalty = 10000
\displaywidowpenalty = 10000
\setlength\fboxsep{6pt}
\setlength\fboxrule{1pt}
\renewcommand*\oldstylenums[1]{{\fontfamily{fxlj}\selectfont #1}}

% ------------------------------------------
% -------- hyphenation rules
% ------------------------------------------
\hyphenation{}

\begin{document}
\pagestyle{fancy}

% -- Title

\title{\LARGE Transaktionssysteme -- Blatt 05\\ \large Team Amazonen -- Gruppe 1}
\author{\large Bastian Huber (51432) \and \large Sebastian Rainer (50882) \and \large Daniel Watzinger (51746)}
\date{\large\today}
\maketitle

\section{BFO}
\begin{enumerate}[label={\alph*)}]
	\item \begin{itemize}
					\item \textbf{Initial:} $r-TS(x) = w-TS(x) = r-TS(y) = w-TS(y) = 0$
					\item \begin{tabularx}{\textwidth}{ | X | X |}
										\hline
										\textbf{Output} & \textbf{Statusänderungen} \\
										\hline \hline
										$w_1(x)$ & $w-TS(x) = 1$ \\
										\hline
										$r_2(y)$ & $r-TS(y) = 2$ \\
										\hline
										$r_1(x)$ & $r-TS(x) = 1$ \\
										\hline
										$r_2(x)$ & $r-TS(x) = 2$ \\
										\hline
										$w_2(y)$ & $w-TS(y) = 2$ \\
										\hline
									\end{tabularx}
					\item $$S_{BFO} = w_1(x) r_2(y) r_1(x) c_1 r_2(x) w_2(y) c_2$$
				\end{itemize}
	\item \begin{itemize}
					\item \textbf{Initial:} $r-TS(x) = w-TS(x) = 0$
					\item \begin{tabularx}{\textwidth}{ | X | X |}
										\hline
										\textbf{Output} & \textbf{Statusänderungen} \\
										\hline \hline
										$r_1(x)$ & $r-TS(x) = 1$ \\
										\hline
										$r_2(x)$ & $r-TS(x) = 2$ \\
										\hline
										$w_3(x)$ & $w-TS(x) = 3$ \\
										\hline
										$w_4(x)$ & $w-TS(x) = 4$ \\
										\hline
										$w_1(x)$ & $TS(T_1) < w-TS(x) \newline TS(T_1) < r-TS(x) \newline \Rightarrow abort(T_1)$ \\
										\hline
										$w_2(x)$ & $TS(T_2) < w-TS(x) \newline \Rightarrow abort(T_2)$ \\
										\hline
									\end{tabularx}
					\item $$S_{BFO} = r_1(x) r_2(x) w_3(x) w_4(x) (w_1(x)) a_1 (w_2(x)) a_2 c_3$$
				\end{itemize}
\end{enumerate}
	
\section{SGT}
\begin{enumerate}[label={\alph*)}]
	\item \begin{itemize}
					\item \textbf{Initial:} $emptyGraph()$
					\item \textbf{Output}: $w_1(x)$
					\item \textbf{Statusänderungen}: \input{graph_2_a_1}
					
					\item \textbf{Output}: $r_2(y)$
					\item \textbf{Statusänderungen}: \input{graph_2_a_2}
					
					\item \textbf{Output}: $r_1(x) c_1$
					\item \textbf{Statusänderungen}: \input{graph_2_a_3}
								$\xrightarrow{Garbage Collection}$ \input{graph_2_a_3_gc}
					
					\item \textbf{Output}: $r_2(x)$
					\item \textbf{Statusänderungen}: \input{graph_2_a_3_gc}
					
					\item \textbf{Output}: $w_2(y) c_2$
					\item \textbf{Statusänderungen}: \input{graph_2_a_3_gc}
								$\xrightarrow{Garbage Collection} emptyGraph()$
								
					\item $$S_{SGT} = w_1(x) r_2(y) r_1(x) c_1 r_2(x) w_2(y) c_2$$
				\end{itemize}
	\item \begin{itemize}
					\item \textbf{Initial:} $emptyGraph()$
					\item \textbf{Output}: $r_1(x)$
					\item \textbf{Statusänderungen}: \input{graph_2_b_1}
					
					\item \textbf{Output}: $r_2(x)$
					\item \textbf{Statusänderungen}: \input{graph_2_b_2}
					
					\item \textbf{Output}: $w_3(x)$
					\item \textbf{Statusänderungen}: \input{graph_2_b_3}
					
					\item \textbf{Output}: $w_4(x)$
					\item \textbf{Statusänderungen}: \input{graph_2_b_4}
					
					\item \textbf{Output}: $w_1(x) a_1$
					\item \textbf{Statusänderungen}: \input{graph_2_b_5} Zyklus \lightning \input{graph_2_b_6}
								
					\item \textbf{Output}: $w_2(x) a_2$
					\item \textbf{Statusänderungen}: \input{graph_2_b_7} Zyklus \lightning \input{graph_2_b_8}
								
					\item \textbf{Output}: $c_3$
					\item \textbf{Statusänderungen}: \input{graph_2_b_8}
								$\xrightarrow{Garbage Collection}$ \input{graph_2_b_9}
								
					\item \textbf{Output}: $c_4$
					\item \textbf{Statusänderungen}: \input{graph_2_b_9}
								$\xrightarrow{Garbage Collection} emptyGraph()$
								
					\item $$S_{SGT} = r_1(x) r_2(x) w_3(x) w_4(x) (w_1(x)) a_1 (w_2(x)) a_2 c_3 c_4$$
				\end{itemize}
\end{enumerate}
	
\section{Optimistische Protokolle: BOCC und FOCC}
\begin{enumerate}[label={\alph*)}]
	\item \begin{itemize}
					\item \textbf{Output:} $r_1(x) r_2(x) r_1(y) r_3(x) c_1$
					\item \textbf{Validate($T_1$):} $accept()$ da bisher keine Transaktion erfolgreich abgeschlossen ist.
					\item \textbf{Write:} $w_1(x) w_1(y)$
					\item \textbf{Output:} $r_2(y) r_3(z) a_3$
					\item \textbf{Validate($T_3$):} $$RS(T_3) = \{x,z\} \cap \{x,y\} = WS(T_1) = \{x\} \neq \emptyset$$
					\item \textbf{Output:} $r_2(z) a_2$
					\item \textbf{Validate($T_2$):} $$RS(T_2) = \{x,y,z\} \cap \{x,y\} = WS(T_1) = \{x,y\} \neq \emptyset$$
					\item $$S_{BOCC} = r_1(x) r_2(x) r_1(y) r_3(x) w_1(x) w_1(y) c_1 r_2(y) r_3(z) a_3 r_2(z) a_2$$
				\end{itemize}
				
	\item \begin{itemize}
					\item \textbf{Output:} $r_1(x) r_2(x) r_1(y) r_3(x) a_1$
					\item \textbf{Validate($T_1$):} $$WS(T_1) = \{x,y\} \cap \{x\} = RS^{n^{1}}(T_2) = \{x\} \neq \emptyset$$
																					$$WS(T_1) = \{x,y\} \cap \{x\} = RS^{n^{1}}(T_3) = \{x\} \neq \emptyset$$
					
					\item \textbf{Output:} $r_2(y) r_3(z) c_3$
					\item \textbf{Validate($T_3$):} $$WS(T_3) = \{z\} \cap \{x,y\} = RS^{n^{2}}(T_2) = \emptyset$$
					\item \textbf{Write:} $w_3(z)$
					\item \textbf{Output:} $r_2(z) c_2$
					\item \textbf{Validate($T_2$):} $accept()$ da keine andere Transaktion zurzeit in der Lesephase ist. (Außerdem ist $T_2$ eine rein lesende Transaktion.)
					\item $$S_{FOCC} = r_1(x) r_2(x) r_1(y) r_3(x) w_1(x) w_1(y) a_1 r_2(y) r_3(z) c_3 w_3(z) r_2(z) c_2$$
				\end{itemize}
\end{enumerate}

\section{MGL (Multiple Granularity Locking)}
	Angenommen $T_1$ und $T_2$ halten nicht kompatible Sperren $l_1$ und $l_2$ implizit oder explizit auf ein Datenobjekt $A$ in $H$.
	\begin{description}
		\item[Fall 1] Sei $A$ die Wurzel von $H$. Dann verhindert die MGL-Verträglichkeitsmatrix die obige Situation \lightning
		\item[Fall 2] O.b.d.A. gilt $l_1 <_S l_2$ in dem betrachteten Schedule $S$. Dann hält $T_1$ unter anderem auch Intentionssperren auf die Vorgänger
			des Datenobjekts $A$. Also verhindert wiederum die MGL-Verträglichkeitsmatrix eine implizite oder explizite Sperre $l_2 $auf $A$ \lightning
	\end{description}
	
\section{Phantom Problem}
\begin{enumerate}[label={\alph*)}]
		\item \begin{tabularx}{\textwidth}{ | X | X | X |}
										\hline
										\textbf{Transaktion 1} & \textbf{Transaktion 2} & \textbf{Output} \\
										\hline \hline
										SELECT Count(*) FROM personen WHERE geburtsjahr > 1750 & & 2\\
										\hline
										& SELECT Count(*) FROM personen WHERE geburtsjahr > 1750& 2\\
										\hline
										INSERT INTO personen VALUES (121212,'Albert Einstein',1879) & & blockiert\\
										\hline 
										& INSERT INTO personen VALUES (424242,'Friedrich Schiller',1759) & blockiert\\
										\hline 
										& & INSERT von Transaktion 1 wird aufgeführt \\
										\hline 
										& & Fehlermeldung bei Transaktion 2 \\
										\hline
										SELECT Count(*) FROM personen WHERE geburtsjahr > 1750 & & 3 \\
										\hline
										& SELECT Count(*) FROM personen WHERE geburtsjahr > 1750 & blockiert \\
										\hline
										commit & & Ausgabe $3$ bei Transaktion 2 \\
										\hline
										& commit & \\
										\hline
								\end{tabularx}
		\item DB2 blockiert einfach bei konkurrentem Schreiben auf den Tabellen.
		
	\item \begin{tabularx}{\textwidth}{ | X | X | X |}
										\hline
										\textbf{Transaktion 1} & \textbf{Transaktion 2} & \textbf{Output} \\
										\hline \hline
										SELECT Count(*) FROM personen WHERE geburtsjahr > 1750 & & 2\\
										\hline
										& SELECT Count(*) FROM personen WHERE geburtsjahr > 1750& 2\\
										\hline
										INSERT INTO personen VALUES (121212,'Albert Einstein',1879) & & erfolgreich\\
										\hline 
										& INSERT INTO personen VALUES (424242,'Friedrich Schiller',1759) & erfolgreich\\
										\hline 
										& & INSERT von Transaktion 1 wird aufgeführt \\
										\hline 
										& & Fehlermeldung bei Transaktion \\
										\hline
										SELECT Count(*) FROM personen WHERE geburtsjahr > 1750 & & 3 \\
										\hline
										& SELECT Count(*) FROM personen WHERE geburtsjahr > 1750 & 3 \\
										\hline
										commit & & \\
										\hline
										& commit & \\
										\hline
								\end{tabularx}
	\item PostgreSQL lässt letztendlich jede Transaktion auf der Tabelle arbeiten, die zu Beginn der Transaktion vorhanden war.
\end{enumerate}
\end{document}
